<!doctype html>
<html lang="lv" data-bs-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Darbības Vārds — Vārdu Savienošanas Spēle</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="favicon.ico" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.13.1/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    :root{--bg:#0b0f14;--card:#111827;--muted:#64748b;--text:#e5e7eb;--accent:#2563eb;--accent-2:#22c55e;--warn:#ef4444}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,\
    Noto Sans,sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column;position:static;overflow-x:hidden;overflow-y:auto;width:100%}
    header{padding:24px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between}
    header .title{font-size:clamp(20px,3vw,28px);font-weight:700}
    header a.btn{color:var(--text);text-decoration:none;border:1px solid #1f2937;padding:10px 14px;border-radius:12px;background:#0f172a}
    main{flex:1;display:grid;place-items:start;gap:24px;padding:0 16px 32px}
    .panel{max-width:1100px;width:100%;margin:0 auto;background:var(--card);border:1px solid #1f2937;border-radius:18px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between}
    .controls .group{display:flex;gap:10px;align-items:center}
    .segmented{display:inline-flex;border:1px solid #1f2937;border-radius:12px;overflow:hidden}
    .segmented button{background:#0f172a;color:var(--text);padding:8px 12px;border:0;cursor:pointer}
    .segmented button[aria-pressed="true"]{background:var(--accent);color:white}
    .btn{background:#0f172a;color:var(--text);border:1px solid #1f2937;padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:white}
    .btn.ghost{background:transparent}
    /* Keep LV and target columns side by side even on mobile */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:16px}
    .col{background:#0f1220;border:1px solid #1f2937;border-radius:16px;min-height:320px}
    .col h3{margin:0;padding:12px 14px;border-bottom:1px solid #1f2937;color:#cbd5e1;display:flex;align-items:center;gap:8px}
    ul.words{list-style:none;margin:0;padding:8px}
    ul.words li{padding:10px 12px;margin:6px;border:1px dashed #334155;border-radius:12px;cursor:pointer;user-select:none;transition:transform .05s ease}
    ul.words li:hover{transform:translateY(-1px)}
    ul.words li.selected{outline:2px solid var(--accent)}
    ul.words li.matched{background:rgba(34,197,94,.08);border-color:rgba(34,197,94,.35);color:#c7f9cc}
    ul.words li.wrong{background:rgba(239,68,68,.08);border-color:rgba(239,68,68,.35)}
    .status{display:flex;gap:12px;align-items:center;color:#cbd5e1}
    .status .pill{border:1px solid #1f2937;border-radius:999px;padding:6px 10px;background:#0f172a}
    .muted{color:var(--muted)}
    .footer{opacity:.85;font-size:14px;margin-top:10px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(() => {});
    }
  </script>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary fixed-top border-bottom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
        <i class="bi bi-translate"></i> Latvian B1
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNav" aria-controls="offcanvasNav" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNav" aria-labelledby="offcanvasNavLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasNavLabel">Menu</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body align-items-lg-center">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link active" aria-current="page" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="darbibas-vards.html">Darbības vārds</a></li>
            <li class="nav-item"><a class="nav-link" href="week1.html">Week 1</a></li>
          </ul>

          <div class="d-flex gap-2">
            <button id="themeToggle" class="btn btn-outline-secondary" type="button" aria-label="Toggle color mode">
              <i class="bi bi-moon-stars-fill d-none" id="iconDark"></i>
              <i class="bi bi-sun-fill" id="iconLight"></i>
            </button>
            <a class="btn btn-primary" href="https://github.com/oerbey/Latvian_Lang_B1" target="_blank" rel="noopener">
              <i class="bi bi-github"></i> <span class="ms-1 d-none d-sm-inline">GitHub</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <main class="container py-4 mt-5">
    <header>
      <div class="title">Darbības Vārds — savieno LV ⇄ ENG/RU</div>
      <nav>
        <a class="btn" href="./index.html" aria-label="Atpakaļ uz sākumu">⟵ Atpakaļ</a>
      </nav>
    </header>

    <section class="panel" aria-labelledby="controls-heading">
      <h2 id="controls-heading" class="sr-only">Vadība</h2>
      <div class="controls">
        <div class="group">
          <div class="segmented" role="tablist" aria-label="Mērķa valoda">
            <button id="lang-eng" role="tab" aria-selected="true" aria-pressed="true">LV → ENG</button>
            <button id="lang-ru" role="tab" aria-selected="false" aria-pressed="false">LV → RU</button>
          </div>
          <span class="muted">Izvēlies mērķa valodu.</span>
        </div>
        <div class="group">
          <label for="round-size">Pāru skaits:</label>
          <input id="round-size" type="range" min="6" max="16" step="2" value="10" />
          <span id="round-size-val" class="pill">10</span>
        </div>
        <div class="group">
          <button id="new-round" class="btn primary">Jauna spēle</button>
          <button id="reset-progress" class="btn ghost">Notīrīt atlasi</button>
        </div>
      </div>
      <div class="footer muted">Datu avots: <code>data/latvian_words_with_translations.xlsx</code> (Sheet1, kolonnas: LV, ENG, RU). Ja fails nav atrasts, tiek izmantots iebūvēts neliels piemērs.</div>
    </section>

    <section class="panel">
      <div class="status" aria-live="polite">
        <div class="pill">Pareizi: <span id="correct">0</span></div>
        <div class="pill">Nepareizi: <span id="wrong">0</span></div>
        <div class="pill">Atlikušais: <span id="remain">0</span></div>
        <div class="muted" id="loader">– tiek ielādēti vārdi…</div>
      </div>
      <div class="grid" id="game" hidden>
        <div class="col">
          <h3>Latviski (LV)</h3>
          <ul id="lv-list" class="words"></ul>
        </div>
        <div class="col">
          <h3 id="target-title">Angliski (ENG)</h3>
          <ul id="target-list" class="words"></ul>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-top py-4 bg-body-tertiary">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-3">
      <span class="text-secondary">© <span id="year"></span> Latvian B1 Games</span>
      <nav class="small">
        <a class="link-secondary me-3" href="index.html">Home</a>
        <a class="link-secondary me-3" href="darbibas-vards.html">Verbs</a>
        <a class="link-secondary" href="week1.html">Week 1</a>
      </nav>
    </div>
  </footer>

  <!-- Bootstrap bundle (incl. Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  // ====== Data loading ======
  const EXCEL_PATH = 'data/latvian_words_with_translations.xlsx';
  /**
   * Fallback example (kept tiny): used only if Excel file is missing.
   */
  const SAMPLE_DATA = [
    { LV: 'abonēt', ENG: 'subscribe', RU: 'подписываться' },
    { LV: 'absolvēt', ENG: 'graduate', RU: 'выпускаться' },
    { LV: 'adīt', ENG: 'knit', RU: 'вязать' },
    { LV: 'aicināt', ENG: 'invite', RU: 'приглашать' },
    { LV: 'aiziet', ENG: 'to leave', RU: 'уезжать' },
    { LV: 'aizmirst', ENG: 'forget', RU: 'забывать' },
    { LV: 'aiznest', ENG: 'carry', RU: 'нести' },
    { LV: 'aizpildīt', ENG: 'to fill out', RU: 'заполнять' },
    { LV: 'apciemot', ENG: 'visit', RU: 'посещать' },
    { LV: 'apgūt', ENG: 'learn', RU: 'изучать' },
  ];

  /** Read the first sheet and return rows with LV/ENG/RU */
  async function loadExcelRows() {
    try {
      const resp = await fetch(EXCEL_PATH);
      if (!resp.ok) throw new Error('File not found');
      const ab = await resp.arrayBuffer();
      const wb = XLSX.read(ab, { type: 'array' });
      const ws = wb.Sheets[wb.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(ws, { defval: '' });
      return rows.filter(r => r.LV && (r.ENG || r.RU));
    } catch (err) {
      console.warn('Excel file missing or unreadable, using sample data.', err);
      return SAMPLE_DATA;
    }
  }

  /** Pick n random rows and add id */
  function pickRound(data, n = 10) {
    const shuffled = data.map((r, i) => ({ ...r, id: i })).sort(() => Math.random() - 0.5);
    return shuffled.slice(0, n);
  }

  // ====== Game state ======
  let ALL = [];
  let CURRENT = [];
  let TARGET = 'ENG';
  let selectedLV = null;
  let selectedTarget = null;
  let wrongCount = 0;
  const ui = {
    langEng: document.getElementById('lang-eng'),
    langRu: document.getElementById('lang-ru'),
    roundSize: document.getElementById('round-size'),
    roundSizeVal: document.getElementById('round-size-val'),
    newRound: document.getElementById('new-round'),
    reset: document.getElementById('reset-progress'),
    lvList: document.getElementById('lv-list'),
    targetList: document.getElementById('target-list'),
    correct: document.getElementById('correct'),
    wrong: document.getElementById('wrong'),
    remain: document.getElementById('remain'),
    loader: document.getElementById('loader'),
    targetTitle: document.getElementById('target-title'),
    game: document.getElementById('game')
  };

  function shuffle(arr) {
    return arr.map(v => ({ v, sort: Math.random() })).sort((a, b) => a.sort - b.sort).map(({ v }) => v);
  }

  function renderLists(){
    // Left list (LV) keeps original order
    ui.lvList.innerHTML = '';
    CURRENT.forEach(row => {
      const li = document.createElement('li');
      li.textContent = row.LV;
      li.dataset.id = row.id;
      li.dataset.side = 'LV';
      li.addEventListener('click', onPick);
      ui.lvList.appendChild(li);
    });

    // Right list (target) is shuffled
    const shuffled = shuffle(CURRENT.map(r => ({ id: r.id, text: r[TARGET] })));
    ui.targetList.innerHTML = '';
    shuffled.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item.text || '—';
      li.dataset.id = item.id;
      li.dataset.side = 'TARGET';
      li.addEventListener('click', onPick);
      ui.targetList.appendChild(li);
    });

    ui.correct.textContent = document.querySelectorAll('li.matched').length / 2;
    ui.remain.textContent = CURRENT.length;
    ui.targetTitle.textContent = TARGET === 'ENG' ? 'Angliski (ENG)' : 'Krievu valodā (RU)';
  }

  function onPick(e){
    const li = e.currentTarget;
    if(li.classList.contains('matched')) return;

    const side = li.dataset.side;
    if(side === 'LV'){
      if(selectedLV) selectedLV.classList.remove('selected');
      selectedLV = li; li.classList.add('selected');
    } else {
      if(selectedTarget) selectedTarget.classList.remove('selected');
      selectedTarget = li; li.classList.add('selected');
    }

    if(selectedLV && selectedTarget){
      checkMatch();
    }
  }

  function checkMatch(){
    const lv = selectedLV;
    const target = selectedTarget;
    const isMatch = lv?.dataset.id === target?.dataset.id;
    const mark = cls => [lv, target].forEach(el => el && el.classList.add(cls));
    const unselect = () => [lv, target].forEach(el => el && el.classList.remove('selected'));

    if(isMatch){
      mark('matched');
      // Remove that pair from CURRENT so remain counter drops
      const id = lv.dataset.id;
      const idx = CURRENT.findIndex(r => r.id === id);
      if(idx !== -1) CURRENT.splice(idx,1);
      ui.correct.textContent = document.querySelectorAll('li.matched').length / 2;
      ui.remain.textContent = CURRENT.length;
    } else {
      wrongCount++;
      ui.wrong.textContent = wrongCount;
      mark('wrong');
      setTimeout(() => [lv, target].forEach(el => el && el.classList.remove('wrong')), 300);
    }

    selectedLV = null; selectedTarget = null; unselect();
  }

  function newRound(){
    const n = parseInt(ui.roundSize.value, 10) || 10;
    CURRENT = pickRound(ALL, n);
    selectedLV = selectedTarget = null;
    wrongCount = 0;
    ui.correct.textContent = 0;
    ui.wrong.textContent = 0;
    ui.lvList.innerHTML = ui.targetList.innerHTML = '';
    renderLists();
    ui.game.hidden = false;
  }

  // ====== Wire up controls ======
  ui.roundSize.addEventListener('input', () => ui.roundSizeVal.textContent = ui.roundSize.value);
  ui.newRound.addEventListener('click', newRound);
  ui.reset.addEventListener('click', () => {
    document.querySelectorAll('li.selected').forEach(el => el.classList.remove('selected'));
    selectedLV = selectedTarget = null;
  });
  ui.langEng.addEventListener('click', () => setTarget('ENG'));
  ui.langRu.addEventListener('click', () => setTarget('RU'));
  function setTarget(code){
    TARGET = code;
    ui.langEng.setAttribute('aria-pressed', code==='ENG');
    ui.langRu.setAttribute('aria-pressed', code==='RU');
    renderLists();
  }

  // ====== Boot ======
  (async function init(){
    ui.loader.textContent = 'Ielādē datus…';
    ALL = await loadExcelRows();
    // Basic de-dup + cleanup
    const seen = new Set();
    ALL = ALL.filter(r => {
      const key = r.LV + '|' + r.ENG + '|' + r.RU;
      if(seen.has(key)) return false; seen.add(key); return true;
    });
    ui.loader.textContent = `Kopā pieejami ${ALL.length} vārdi.`;
    newRound();
  })();
  </script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
  <script src="theme.js"></script>
</body>
</html>
